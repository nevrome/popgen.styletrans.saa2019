---
title: "A Population Graph based Style Transmission model"
date: "12/04/2019"
fontsize: 9pt
output:
  beamer_presentation:
    includes: 
      in_header: preamble.tex
    keep_tex: true
fig_caption: yes
editor_options: 
  chunk_output_type: console
---

```{r, echo = FALSE}
# https://stackoverflow.com/questions/25646333/code-chunk-font-size-in-rmarkdown-with-knitr-and-latex
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```

## TOC

\textblockcolour{mDarkTeal}

\LARGE

\begin{enumerate}
  \item The Neiman (1995) model
  \item Idea agents in a diachronic population network
  \begin{itemize}
    \item Population generation
    \item Relations generation
    \item Idea expansion
  \end{itemize}
  \item Application example
\end{enumerate}

# The Neiman (1995) model

## Style transmission

Time series

# Idea agents in a diachronic population network

## Overview

## Population generation: Algorithm

## Population generation: Code sample I

```{r, eval=FALSE}
time <- 1:200
unit_names <- factor(c("group_1", "group_2", "group_3", "group_4"))
unit_size_functions <- list(
  "group_1" = function(t) {20 + 0.4 * t}, 
  "group_2" = function(t) {20 + (0.04 * t)^2},
  "group_3" = function(t) {50}, 
  "group_4" = function(t) {20 + 15 * log(t)}
)
age_distribution_function <- function(x) {
  1 / (1 + 0.0004 * 0.7^(-7 * log(x)))
}
age_range <- 1:90

popgenerator::init_population_settings(
  time, unit_names, unit_size_functions, 
  age_distribution_function, age_range
) %>% popgenerator::generate_population() -> population
```

## Population generation: Result

![](figures/code_sample_I_population_generation.jpg)

## Relations generation: Algorithm

## Relations generation: Code sample II

```{r, eval=FALSE}
amount_friends <- 10
distance_matrix_equal <- matrix(1, 4, 4) %>% `diag<-`(0)
cross_unit_proportion_child_of <- 0.002
cross_unit_proportion_friend <- 0.01
weight_child_of <- 50
weight_friend <- 10

settings <- popgenerator::init_relations_settings(
  population, amount_friends, distance_matrix_equal, 
  cross_unit_proportion_child_of, cross_unit_proportion_friend,
  weight_child_of, weight_friend
) 

relations <- popgenerator::generate_relations(settings)
```

## Relations generation: Result

![](figures/code_sample_II_relations_generation.jpg)

Population graph Fruchterman-Reingold

## Idea expansion: Algorithm

## Idea expansion: Code sample III

```{r, eval=FALSE}
system2(
  "../gluesless/build/gluesless", 
  args = c(
    "-pi", graph_file, 
    "-ii", ideas_file, 
    "-o", output_file, "-q"
    )
)
result <- readLines("tmp_data/gluesless_result.txt")

idea_development <- population %>%
  dplyr::mutate(
    idea = ifelse(id %in% result_idea_1_nodes, "idea_1", "idea_2"),
    from = birth_time - abs(birth_time - death_time)/2, 
    to = death_time
  ) %>%
  aoristAAR::aorist(
    split_vars = c("unit", "idea")
  )
```

## Idea expansion: Result

![](figures/code_sample_III_idea_generation.jpg)

# Application example

## Cultural distance
